theme: Next, 9
[.hide-footer]

<!-- 
custom colors:

black   : black             : #000000
blue    : sapphireblue      : #2554C7
brown   : peru              : #CD853F
gray    : lightgray         : #D3D3D3
green   : mediumseagreen    : #3CB371
orange  : darkorange        : #FF8C00
pink    : hotpink           : #FF69B4
purple  : violet            : #EE82EE
red     : orangered         : #FF4500
white   : white             : #000000
yellow  : gold              : #FFD700
 -->

# [FIT] Welcome

---

```
```
```
```
```
```
# [FIT] **Are you aware?**
> _Aware of **your liability** as a software engineer **!**_

---

# About Me

* Marco Pas
* Happy Coder/Software Architect/DevOps Engineer
* Prototype / First of a kind development
* Doing fun and interesting stuff
* @ Philips Research

![right](assets/philips-heritage.png)

---

# Research Areas

* Consumer products
* HealthCare

# Some innovations

* Medical X-ray tube
* Mixed Tapes / CD / DVD
* Ambilight TV
* Airfloss

![right, 80%](assets/philips-healthcare.jpg)

---

![](https://www.youtube.com/watch?v=loGxO3L7rFE&t=60s)



---

# We did not invent this :)
```
```

[.header: alignment(center)]
![original](assets/stroopwafels.png)

---

```
```
# [FIT] Lets start 
# [FIT] with an essential question!
> _**What are we?**_
>
```
```

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# [FIT] Professionals

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

[.build-lists: true]

# Our profession

- Developers
- Product Managers
- Agilists
- Testers
- Architects
- Managers
- ...

![right](assets/coding.jpg)

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# We are all proud 
# of the things we
# [FIT] create

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---
# We as software engineers are 
# [FIT] awesome
#...

![right fit](assets/yesterday-it-worked.jpg)

---

# We have fun

```
```
```
```
```
```

[.code-highlight: 1-2]

```java
Exception up = new Exception("Something is really wrong.");
throw up;
```

---

# Sometime we are ignorant

```
```
```
```
```
```

[.code-highlight: 1-3]

```java
Catch (Exception e) {
 //who cares?
}
```

---

# Sometimes we make mistakes

```
```
```
```


[.code-highlight: 1-6]

```c
int getRandomize(int randMax)
{
  srand ( time(NULL) );
  int randNum; = rand() % randMax + 1;
  return 2; /* :) */
}
```

---

# We also like to write stories 


```
// When I wrote this, only God and I understood what I was doing
// Now, God only knows

--------------------------------------------------------------------------------

// Happy debugging suckers

--------------------------------------------------------------------------------

// Drunk, fix later

--------------------------------------------------------------------------------

// This code sucks, you know it and I know it.
```

---

```
```
```
```
# But are you also aware of the
# [FIT] **consequences**

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

```
```
```
```
# [FIT] Software is everywhere
# and is a challenge/problem

> _**Lets look at some recent challenges ->**_

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# Stalled motor
## Lack of oxygen
### Philips Respironics

![right fit](assets/philips-ventilator.png)

---

# Delayed or overdosed medicine
## Product recall
### _CareFusion_

![right fit](assets/infusion-pump.png)

---

# Software bug assists
## Bank Heist $81 million
### Bangladesh Bank

![right](assets/printer.png)

---

# Killing 8500 Patients
## "On Paper"
### _St. Mary’s Mercy Medical Center_

![right](assets/patients.png)

---

# Releasing 3200 prisoners
## too early
### _Michigan Dept. of Corrections_

![right](assets/jail.png)

---

# Network going down
## 30 million users affected
### _O2_

![right](assets/mobile-network.png)

---

# Revealing affairs
## Pushing notifications
### _Uber_

![right](assets/affair.png)

---

# Missile strike
## State wide alarm
### _Hawaii_

![right](assets/missile-strike.png)

---

# Car emission
## if (test) then lower emission
### _Volkswagen_

![right](assets/volkswagen.png)

---

# Money laundering possible
## after 10 warnings
### _ING Banking_

![right](assets/money-laundring.png)

---
```
```
```
```
```
```
```
```
# [fit] How does this effect us?

[.background-color: #FF4500]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

## [FIT] Law/regulation is coming!

## We are are becoming 
# [fit] liable 
# for the work that we do**!**

[.background-color: #FF4500]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# Liability in negligence

## Duty of care

* **Detailed testing** of the software before commercial release
* Appropriate use of **automated testing and code quality tools**
* **Notifying customers who have been potentially affected** by a defect in the software

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# The Programmer's Oath[^1]

### We need to *regulate ourselves* or others will

* I will, **not produce harmful code.**
* I will, **not knowingly allow code that is defective either in behavior or structure to accumulate**.
* I will, **fearlessly and relentlessly improve my creations at every opportunity.**

![right fit](assets/uncle-bob.png)

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

![original](assets/hygiene.png)
# Hygiene

---

# Hygiene levels

|                               |
| ----------------------------- |
| Application Code              |
| Used Libraries / Dependencies |
| Containers                    |
| Deployment                    |

[.background-color: #2554C7]
[.header: #FFFFFF]
[.text: #FFFFFF]
[.table-separator: #FFFFFF] 

---

# How to deploy and enforce hygiene?

---

# Compliance & Security Testing

### Validate, weather the system developed meets the organization’s prescribed standards or not.

---

# Hygiene levels

|                               |
| ----------------------------- |
| **Application Code**          |
| Used Libraries / Dependencies |
| Containers                    |
| Deployment                    |

[.background-color: #2554C7]
[.header: #FFFFFF]
[.text: #FFFFFF]
[.table-separator: #FFFFFF] 

---

# Application Code

- Coding Standards
- Quality Attributes
  - Bugs, Code Smells, Coverage, Duplication
- Security Issues
- Predictive Analytics and social patterns

---

# SonarQube[^2]

- Continuous Inspection
- Issue detection
- Multi-language
- Centralized:
  - Coding Standards
  - Quality Attributes

![fit right](assets/sonarqube-screenshot.png)

---

# SonarQube Overview
```
```
![original fit](assets/sonarqube-overview.png)

---

Bad
Ex.

![original fit](assets/sonarqube-bad-example.png)

---

# Quality Gates

```
```

![original fit](assets/sonarqube-quality-gate.png)

---

## Define your own
## [FIT] quality gates
## to ensure compliance

---

Include SonarQube + Test Coverage

```groovy
// file: build.gradle
plugins { 
    ...
    id "org.sonarqube" version "2.7.1"
    id "jacoco" 
}

sonarqube {
    properties {
        property "sonar.coverage.jacoco.xmlReportPaths", "$buildDir/reports/jacoco/test/jacocoTestReport.xml"
        property "sonar.coverage.exclusions", ["**/Application.java"]
    }
}

jacocoTestReport {
    reports {
        xml.enabled true
    }
}
```

---

```
```
```
```
# Demo

[SonarQube](http://localhost:9000)

[.header: alignment(center)]
[.text: alignment(center)]

---

# Application Code

- :white_check_mark: Coding Standards 
- :white_check_mark: Quality Attributes
  - Bugs, Code Smells, Coverage, Duplication
- :white_check_mark: Security Issues
- Predictive Analytics and social patterns

---

# Predictive Analysis [^3]
```
```
![original fit](assets/codescene-logo.png)

---

![fit](assets/codescene-code-as-a-crimescene.png)

---

# Every commit leaves a trace

- Which part of the code might become bottlenecks?
- Which parts of the code will be hard to maintain?
- What is the technical risk when a developer leaves the project?
- Which parts of the code should we improve to get a real productivity and quality gain?
- How is the knowledge distribution between teams in your codebase?

---

![fit](assets/codescene-commit-log.png)

---

![original fit](assets/codescene-commit-change-frequency.png)

---

# Hotspots

![right 140%](assets/codescene-hotspots.png)

---

# Knowledge distribution

![right 120%](assets/codescene-knowledge-distribution.png)

---

```
```
```
```
# Demo

[CodeScene Clojure](https://codescene.io/projects/175)

[.header: alignment(center)]
[.text: alignment(center)]

---

# Application Code

- :white_check_mark: Coding Standards 
- :white_check_mark: Quality Attributes
  - Bugs, Code Smells, Coverage, Duplication
- :white_check_mark: Security Issues
- :white_check_mark: Predictive Analytics and social patterns


---

# Hygiene levels

|                                   |
| --------------------------------- |
| Application Code                  |
| **Used Libraries / Dependencies** |
| Containers                        |
| Deployment                        |

[.background-color: #2554C7]
[.header: #FFFFFF]
[.text: #FFFFFF]
[.table-separator: #FFFFFF] 

---

# Used Libraries / Dependencies

- License Management
- Security Incidents (CVE)

---
```
```
```
```

```groovy
import com.github.jk1.license.render.*

plugins {
    ...
    id 'org.owasp.dependencycheck' version '5.0.0-M3.1'
    id 'com.github.jk1.dependency-license-report' version '1.6'
}

licenseReport {
    renderers = [new InventoryHtmlReportRenderer()]
}
```

---

```
```
```
```
# Demo

[License Management / Security Incidents](#)

[.header: alignment(center)]
[.text: alignment(center)]

---
# Used Libraries / Dependencies

- :white_check_mark: License Management
- :white_check_mark: Security Incidents (CVE)

---

# Hygiene levels

|                               |
| ----------------------------- |
| Application Code              |
| Used Libraries / Dependencies |
| **Containers**                |
| Deployment                    |

[.background-color: #2554C7]
[.header: #FFFFFF]
[.text: #FFFFFF]
[.table-separator: #FFFFFF] 

---

# Containers

- Correctly build?
- Trusted and safe?
- Does not expose and strange ports?
- Contains the correct application and settings?

# How do we test and verify?

![right](assets/containers.png)

---

# Docker Build File

```
```
```docker
FROM openjdk:11-jdk-slim
RUN mkdir -p /app
COPY *.jar /app/application.jar
WORKDIR /app
ENTRYPOINT ["java","-Dmicronaut.server.port=8020", "-jar","application.jar"]
```

## [fit] Image :arrow_right: Container

---
# Goss[^4]

- YAML based **serverspec** alternative for validating a server’s configuration
- Writing tests by allowing the user to **generate tests from the current system state**
- Test suite can be **executed, waited-on, or served as a health endpoint**
- Runs on the target!!

![25% right](assets/go-programming-logo.png)

---

# Goss Overview
```
```

![original 100%](assets/goss-overview.png)

---

# Simple test!

```yaml
// file: goss.yaml

http:
  http://localhost:8020/helloworld/:
    status: 200
```

---

![original 120%](assets/goss-test.png)

---
![fit](assets/goss-resources.png)

---

# Creating/Running tests

[.code-highlight: 2-3]

```console
// create/edit tests
$ dgoss edit <container-name>
INFO: Run goss add/autoadd to add resources
# goss add http http://localhost:8020/helloworld/
# exit
INFO: Copied '/goss/goss.yaml' from container to '.'
// run test
$ dgoss run <container-name>
```

---

# Creating/Running tests

[.code-highlight: 4-6]

```console
// create/edit tests
$ dgoss edit <container-name>
INFO: Run goss add/autoadd to add resources
# goss add http http://localhost:8020/helloworld/
# exit
INFO: Copied '/goss/goss.yaml' from container to '.'
// run test
$ dgoss run <container-name>
```

---

# Creating/Running tests

[.code-highlight: 8]

```console
// create/edit tests
$ dgoss edit <container-name>
INFO: Run goss add/autoadd to add resources
# goss add http http://localhost:8020/helloworld/
# exit
INFO: Copied '/goss/goss.yaml' from container to '.'
// run test
$ dgoss run <container-name>
```

---

```
```
```
```
# Demo

[Goss](#)

[.header: alignment(center)]
[.text: alignment(center)]


---

# Inspec - compliance as code

```
```

InSpec is an **open-source** testing framework for infrastructure with a **human-readable language** for specifying **compliance, security and other policy requirements**.

![original right 60%](assets/inspec-audit.png)

---

# Why Inspec

- It's open source
- Development supported by Chef Software Inc.
- Awesome community (Slack)
- Resourch rich!!
- Can run anywhere (local machine, over ssh, docker, winrm)
- Written in Ruby

---

# Questions and answers

> InSpec provides an incredibly easy way to answer questions such as:

- Is package “my_app” installed, “my_service” running?
- Is the SSH server configured to only accept protocol version 2?
- Is the “max_allowed_packet” setting in the “mysql” section of “/etc/my.cnf” set to “16M”?

---

```
```
```
```
# Demo

[Inspec Shell](#)

[.header: alignment(center)]
[.text: alignment(center)]

---

# Simple test(s)

```ruby
describe file('/etc/myapp.conf') do
  it { should exist }
  its ('mode') { should cmp '0644' }
end

describe package('nginx') do
  it { should be_installed }
end

describe port.where { protocol =~ /tcp/ && port > 22 && port < 80 } do
  it { should_not be_listening }
end
```

---

# Inspec Resources

- Operating System
- Amazon WebServices
- Azure
- Google Cloud

![right fit](assets/inspec-resources.png)

---

# Targets

```console
# Login to remote machine using ssh as root
$ inspec shell -t ssh://root@192.168.64.2:11022

# Login to hostname on port 1234 as user using given ssh key
$ inspec shell -t ssh://user@hostname:1234 -i /path/to/user_key

# Login to windowsmachine over WinRM as UserName
$ inspec shell -t winrm://UserName:Password@windowsmachine:1234

# Login to a Docker container
$ inspec shell -t docker://container_id
```

When no target then local is assumed!

---

# Docker resource examples

[.code-highlight: 1-6]

```ruby
describe docker_image('alpine:latest') do
  it { should exist }
  its('id') { should eq 'sha256:4a415e...a526' }
  its('repo') { should eq 'alpine' }
  its('tag') { should eq 'latest' }
end

describe docker.images do
    its('repositories') { should_not include 'insecure_repository' }
end

describe docker.containers do
    its('images') { should_not include 'this-image-should-not-be-used-anymore:latest' }
end
```

---

# Docker resource examples

[.code-highlight: 7-10]

```ruby
describe docker_image('alpine:latest') do
  it { should exist }
  its('id') { should eq 'sha256:4a415e...a526' }
  its('repo') { should eq 'alpine' }
  its('tag') { should eq 'latest' }
end

describe docker.images do
    its('repositories') { should_not include 'insecure_repository' }
end

describe docker.containers do
    its('images') { should_not include 'this-image-should-not-be-used-anymore:latest' }
end
```

---

# Docker resource examples

[.code-highlight: 12-14]

```ruby
describe docker_image('alpine:latest') do
  it { should exist }
  its('id') { should eq 'sha256:4a415e...a526' }
  its('repo') { should eq 'alpine' }
  its('tag') { should eq 'latest' }
end

describe docker.images do
    its('repositories') { should_not include 'insecure_repository' }
end

describe docker.containers do
    its('images') { should_not include 'this-image-should-not-be-used-anymore:latest' }
end
```

---

# Inspec Profiles[^6]

> Describe best configuration practices for specific services

```
```

- SSH
- Linux
- Docker
- Postgress
- ...

![right fit](assets/inspec-profile-devsec.png)

---

# Inspec Controls

```ruby
container_name = attribute('container_name', 
                            description: 'Name of the container to be tested.', 
                            default: 'Please specify with ATTRIBUTES FLAG --attrs')

control "001-container-should-be-running" do
  impact 1.0
  title "Container should be running."
  desc "The container should be running."
  
  describe docker_container(container_name) do
    it { should exist }
    it { should be_running }
  end
end
```

---

```
```
```
```
# Demo

[Inspec](#)

[.header: alignment(center)]
[.text: alignment(center)]

---

# Vulnerability Static Analysis for Containers[^7]

![right 18%](assets/clair-logo.png)

- Open Source
- Scan layers in images
- Whitelist support
- Easy integration into CI/CD pipelines

---

# Clair Overview

```
```

![80% original](assets/clair-overview.png)

---

# CVE Data Sources

```
```

![original 100%](assets/clair-cve-resources.png)

---

# Whitelist support

```
```
```yaml
generalwhitelist: #Approve CVE for any image
  CVE-2017-6055: XML
  CVE-2017-5586: OpenText
images:
  ubuntu: #Apprive CVE only for ubuntu image, regardles of the version
    CVE-2017-5230: Java
    CVE-2017-5230: XSX
  alpine:
    CVE-2017-3261: SE
```
---

```
```
```
```
# Demo

[Clair](#)

[.header: alignment(center)]
[.text: alignment(center)]

---

# Hygiene Levels

|                               |
| ----------------------------- |
| Application Code              |
| Used Libraries / Dependencies |
| Containers                    |
| **Deployment**                |

[.background-color: #2554C7]
[.header: #FFFFFF]
[.text: #FFFFFF]
[.table-separator: #FFFFFF] 

---

# Deployment

- Multicloud
- Best practices per vendor
- Auditing 

---

# Scout Suite

- Open Source
- Stable and actively maintained
- Multi-cloud
  - Amazon Web Services
  - Microsoft Azure
  - Google Cloud Platform
- Python

![right 60%](assets/scoutsuite-logo.png)

---

# Compliance notes

- **does not require AWS/Azure/GCO users**,  to complete and submit the AWS Vulnerability / Penetration Testing or contact Microsoft/Google to begin testing

# [fit] But please read the
# [fit] Acceptable Use Policy and the Terms of Service

---

```
```
```
```
# Demo

[ScoutSuite](#)

[.header: alignment(center)]
[.text: alignment(center)]

---

# [fit] The human factor

[.background-color: #347C2C]
[.header: #FFFFFF]
[.text: #FFFFFF]

---

# Why do quality tools often fail

- **Resistance**
  - There is other important work to do
  - The tools are to slow
  - They dont work correctly
  - Coding standards just suck
  - Management is trying to execute a blame game
- **Nasty corner cases**
  
---

# Conclusion

Be aware that software is everywhere! You influence peoples lives! So do your utmost best to make them secure and "bug" free. Invest in code analysis, etc..

# [fit] Take your duty seriously!!

---

# Q & A

---

# Thank you**!**
```
```
```
```
All sources for the presentation can be found at:

- [https://github.com/mpas/compliance-and-security-testing](https://github.com/mpas/compliance-and-security-testing)

<!-- 

Footnotes

[^1]: The Programmer's Oath - [https://blog.cleancoder.com/uncle-bob/2015/11/18/TheProgrammersOath.html](https://blog.cleancoder.com/uncle-bob/2015/11/18/TheProgrammersOath.html)

[^2]: SonarQube - [https://www.sonarqube.org/](https://www.sonarqube.org/)

[^3]: CodeScene - [https://codescene.io/](https://codescene.io/)

[^4]: Goss - Quick and Easy server testing/validation - [https://github.com/aelsabbahy/goss](https://github.com/aelsabbahy/goss)

[^5]: Inspec - Compliance as Code - [https://www.inspec.io/](https://www.inspec.io/)

[^6]: DevSec.io - [https://dev-sec.io](https://dev-sec.io)

[^7]: Clair Container Scan - [https://github.com/coreos/clair](https://github.com/coreos/clair)

[^8]: Bad Dockerfile - [https://www.stindustries.net/docker/bad-dockerfile/](https://www.stindustries.net/docker/bad-dockerfile/)

[^9]: ScoutSuite - [https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite)

-->